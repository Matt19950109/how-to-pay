<h1>支出一覧画面</h1>

<div class = container>
  <div class="row">
    <%#銀行名登録のボタン%>
    <div class="hstack gap-2 col-4">
      <%= link_to '銀行名を登録', new_bank_path, class: "btn btn-outline-secondary fw-bold" %>


      <div class="dropdown">
        <button class="btn btn-outline-secondary dropdown-toggle fw-bold" data-bs-toggle="dropdown">登録済の銀行<span class="badge bg-secondary text-white ms-2"><%= @bank_count %></span></button>
        <ul class="dropdown-menu">
          <% @banks.each do |bank| %>
              <li><%= link_to bank.name, bank_path(bank.id), class: "dropdown-item list-group-item-light text-decoration-none" %></li>
          <% end %>
        </ul>  
      </div>
    </div>

    <%#決済方法登録のボタン%>
    <div class="hstack gap-2 col-4 offset-1">
      <div>
        <%= link_to '決済方法を登録', new_settlement_path, class: "btn btn-outline-danger fw-bold" %>
      </div>

      <div class="dropdown">
        <button class="btn btn-outline-danger dropdown-toggle fw-bold" data-bs-toggle="dropdown">登録済の決済方法<span class="badge bg-danger text-white ms-2"><%= @settlement_count %></span></button>
        <ul class="dropdown-menu">
          <% @settlements.each do |settlement| %>
            <li><%= link_to settlement.payment, settlement_path(settlement.id), class:"dropdown-item list-group-item-light text-decoration-none" %></li>
          <% end %>
        </ul>  
      </div>
    </div>
  </div>
<br>
  <%#支出管理のカレンダーを反映%>
  <%= month_calendar events: @spendings do |date, spendings| %>
    <%= date.day %>

    <% array = [] %>
    <%#支出データがある場合%>
    <% if spendings.any?%>
      <%#月ごとの支出をドロップダウンで表示%>
      <div class="dropdown">
        <button class="btn btn-outline-warning btn-sm dropdown-toggle fw-bold" data-bs-toggle="dropdown">支出の詳細</button>
        <ul class="dropdown-menu">
          <% spendings.each do |spending| %>
          <li><%= link_to spending.price, spending_path(spending.id), class:"dropdown-item list-group-item-light text-decoration-none "%></li>
          <% end %>
        </ul>
      </div>

      <%#日ごとの合計金額を表示%>
      <% spendings.each do |spending| %>
      <% array << spending.price %>
      <% end %>
        <div class="text-danger fw-bold">
        <%= array.sum %>円
        </div>
    <% else %>
    <%#支出データがない場合は空欄に設定%>
    <% end %>
  <% end %>

  <div>
    <%= link_to '支出を登録', new_spending_path, class:"btn btn-warning fw-bold" %>
  </div>

  <br>
  <%#今月の支出の総額表示%>
  <div class="text-danger text-decoration-underline fs-4 fw-bolder">支出総額（今月）：<%= @total.sum(:price)[Date.today.month] %>円</div>


  <div class="col-md-6 col-xl-4">
  <ul class="list-group list-group">
    <% @this_month_bank.each do |key, value| %>
      <li class="list-group-item"><%= "#{key}: #{value}" %></li>
    <% end %>
  </ul>
  </div>

  <div class="col-md-6 col-xl-4">
  <ul class="list-group list-group">
    <% @this_month_payment.each do |key, value| %>
      <li class="list-group-item"><%= "#{key}: #{value}" %></li>
    <% end %>
  </ul>
  </div>

  <div>
  <%= link_to 'ログアウト', destroy_user_session_path, data: { turbo_method: :delete }, class: "btn btn-primary" %>
  </div>
</div>